<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../">
  <title data-ice="title">src/contracts/implementations/arbitrable/MultipleArbitrableTransaction.js | kleros-api</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A Javascript library that makes it easy to build relayers and other DApps that use the Kleros protocol."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="kleros-api"><meta property="twitter:description" content="A Javascript library that makes it easy to build relayers and other DApps that use the Kleros protocol."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/kleros.js~Kleros.html">Kleros</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#contracts">contracts</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/AbstractContract.js~AbstractContract.html">AbstractContract</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/ContractImplementation.js~ContractImplementation.html">ContractImplementation</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#contracts-abstractions">contracts/abstractions</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/abstractions/Arbitrable.js~ArbitrableContract.html">ArbitrableContract</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/abstractions/Arbitrator.js~Arbitrator.html">Arbitrator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/abstractions/MultipleArbitrable.js~ArbitrableContract.html">ArbitrableContract</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#contracts-implementations-pnk">contracts/implementations/PNK</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/implementations/PNK/MiniMePinakion.js~MiniMePinakion.html">MiniMePinakion</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/implementations/PNK/PinakionPOC.js~PinakionPOC.html">PinakionPOC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/implementations/PNK/TokenFactory.js~TokenFactory.html">TokenFactory</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#contracts-implementations-rng">contracts/implementations/RNG</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/implementations/RNG/BlockHashRNG.js~BlockHashRNG.html">BlockHashRNG</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#contracts-implementations-arbitrable">contracts/implementations/arbitrable</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/implementations/arbitrable/Arbitrable.js~Arbitrable.html">Arbitrable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/implementations/arbitrable/ArbitrablePermissionList.js~ArbitrablePermissionList.html">ArbitrablePermissionList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/implementations/arbitrable/ArbitrableTransaction.js~ArbitrableTransaction.html">ArbitrableTransaction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/implementations/arbitrable/MultipleArbitrableTransaction.js~MultipleArbitrableTransaction.html">MultipleArbitrableTransaction</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#contracts-implementations-arbitrator">contracts/implementations/arbitrator</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/implementations/arbitrator/Kleros.js~Kleros.html">Kleros</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contracts/implementations/arbitrator/KlerosPOC.js~KlerosPOC.html">KlerosPOC</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#resources">resources</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/resources/Auth.js~Auth.html">Auth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/resources/Disputes.js~Disputes.html">Disputes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/resources/Notifications.js~Notifications.html">Notifications</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/EventListener.js~EventListener.html">EventListener</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/StoreProviderWrapper.js~StoreProviderWrapper.html">StoreProviderWrapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/Web3Wrapper.js~Web3Wrapper.html">Web3Wrapper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-PromiseQueue">PromiseQueue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-delegateCalls">delegateCalls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-deployContractAsync">deployContractAsync</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getContractAddress">getContractAddress</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-httpRequest">httpRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isRequired">isRequired</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/contracts/implementations/arbitrable/MultipleArbitrableTransaction.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import multipleArbitrableTransactionArtifact from &apos;kleros-interaction/build/contracts/MultipleArbitrableTransaction&apos;
import _ from &apos;lodash&apos;

import * as contractConstants from &apos;../../../constants/contract&apos;
import * as errorConstants from &apos;../../../constants/error&apos;
import deployContractAsync from &apos;../../../utils/deployContractAsync&apos;

import Arbitrable from &apos;./Arbitrable&apos;

/**
 * Provides interaction with an Arbitrable Transaction contract deployed on the blockchain.
 */
class MultipleArbitrableTransaction extends Arbitrable {
  /**
   * Constructor ArbitrableTransaction.
   * @param {object} web3Provider instance
   * @param {string} contractAddress of the contract
   */
  constructor(web3Provider, contractAddress) {
    super(web3Provider, multipleArbitrableTransactionArtifact, contractAddress)

    this.arbitrableTransactionId = null
  }

  /**
   * Deploy MultipleArbitrableTransaction.
   * @param {object} account Ethereum account
   * @param {object} web3Provider web3 provider object
   * @returns {object} truffle-contract Object | err The deployed contract or an error
   */
  static deploy = async (account, web3Provider) =&gt; {
    const contractDeployed = await deployContractAsync(
      account,
      0,
      multipleArbitrableTransactionArtifact,
      web3Provider
    )

    return contractDeployed
  }

  /**
   * Create MultipleArbitrableTransaction.
   * @param {object} account Ethereum account
   * @param {string} arbitratorAddress The address of the arbitrator contract
   * @param {object} seller Seller Ethereum account
   * @param {number} value funds to be placed in contract
   * @param {number} timeout Time (seconds) after which a party automatically loose a dispute. (default 3600)
   * @param {bytes} arbitratorExtraData Extra data for the arbitrator. (default empty string)
   * @param {string} metaEvidenceUri Uri meta-evidence. (default empty string)
   * @returns {object} truffle-contract Object | err The deployed contract or an error
   */
  createArbitrableTransaction = async (
    account,
    arbitratorAddress,
    seller,
    value,
    timeout = 3600,
    arbitratorExtraData = 0x0,
    metaEvidenceUri
  ) =&gt; {
    await this.loadContract()

    try {
      return this.contractInstance.createTransaction(
        arbitratorAddress,
        timeout,
        seller,
        arbitratorExtraData,
        metaEvidenceUri,
        {
          from: account,
          value: value,
          gas: process.env.GAS || undefined
        }
      )
    } catch (err) {
      console.error(err)
      throw new Error(errorConstants.UNABLE_TO_CREATE_TRANSACTION)
    }
  }

  /**
   * Pay the seller. To be called when the good is delivered or the service rendered.
   * @param {string} account - Ethereum account.
   * @param {number} arbitrableTransactionId - The index of the transaction.
   * @param {amount} amount - Part or all of the amount of the good or the service.
   * @returns {object} - The result transaction object.
   */
  pay = async (account, arbitrableTransactionId, amount) =&gt; {
    await this.loadContract()

    try {
      return this.contractInstance.pay(arbitrableTransactionId, amount, {
        from: account,
        value: 0
      })
    } catch (err) {
      console.error(err)
      throw new Error(errorConstants.UNABLE_TO_PAY_SELLER)
    }
  }

  /**
   * Reimburse the seller. To be called when the good is not delivered or the service rendered.
   * @param {string} account - Ethereum account.
   * @param {number} arbitrableTransactionId - The index of the transaction.
   * @param {amount} amount - Part or all of the amount of the good or the service.
   * @returns {object} - The result transaction object.
   */
  reimburse = async (
    account,
    arbitrableTransactionId,
    amount
  ) =&gt; {
    await this.loadContract()

    try {
      return this.contractInstance.reimburse(arbitrableTransactionId, amount, {
        from: account,
        value: 0
      })
    } catch (err) {
      console.error(err)
      throw new Error(errorConstants.UNABLE_TO_REIMBURSE_BUYER)
    }
  }

  /**
   * Pay the arbitration fee to raise a dispute. To be called by the buyer.
   * @param {string} account - Ethereum account.
   * @param {number} arbitrableTransactionId - The index of the transaction.
   * @param {number} arbitrationCost - Arbitration cost.
   * @returns {object} - The result transaction object.
   */
  payArbitrationFeeByBuyer = async (
    account,
    arbitrableTransactionId,
    arbitrationCost
  ) =&gt; {
    await this.loadContract()

    try {
      return this.contractInstance.payArbitrationFeeByBuyer(
        arbitrableTransactionId,
        {
          from: account,
          value: arbitrationCost
        }
      )
    } catch (err) {
      console.error(err)
      throw new Error(errorConstants.UNABLE_TO_PAY_ARBITRATION_FEE)
    }
  }

  /**
   * Pay the arbitration fee to raise a dispute. To be called by the seller.
   * @param {string} account Ethereum account.
   * @param {number} arbitrableTransactionId - The index of the transaction.
   * @param {number} arbitrationCost - Arbitration cost.
   * @returns {object} - The result transaction object.
   */
  payArbitrationFeeBySeller = async (
    account,
    arbitrableTransactionId,
    arbitrationCost
  ) =&gt; {
    await this.loadContract()

    try {
      return this.contractInstance.payArbitrationFeeBySeller(
        arbitrableTransactionId,
        {
          from: account,
          value: arbitrationCost,
          gas: process.env.GAS || undefined
        }
      )
    } catch (err) {
      console.error(err)
      throw new Error(errorConstants.UNABLE_TO_PAY_ARBITRATION_FEE)
    }
  }

  /**
   * Submit evidence.
   * @param {string} account ETH address of user.
   * @param {number} arbitrableTransactionId - The index of the transaction.
   * @param {string} url A link to an evidence using its URI.
   * @returns {string} txHash Hash transaction.
   */
  submitEvidence = async (
    account,
    arbitrableTransactionId,
    url
  ) =&gt; {
    await this.loadContract()

    const txHashObj = await this.contractInstance.submitEvidence(
      arbitrableTransactionId,
      url,
      {
        from: account,
        value: 0
      }
    )

    return txHashObj.tx
  }

  /**
   * Call by buyer if seller is timeout
   * @param {string} account ETH address of user
   * @param {number} arbitrableTransactionId - The index of the transaction.
   * @returns {object} The result transaction object.
   */
  callTimeOutBuyer = async (
    account,
    arbitrableTransactionId
  ) =&gt; {
    await this.loadContract()

    const transactionArbitrableData = await this.getData(
      arbitrableTransactionId
    )

    const status = transactionArbitrableData.status
    const timeout = transactionArbitrableData.timeout
    const lastInteraction = transactionArbitrableData.lastInteraction

    if (status !== contractConstants.STATUS.WAITING_SELLER) {
      throw new Error(errorConstants.CONTRACT_IS_NOT_WAITING_ON_OTHER_PARTY)
    } else if (Math.trunc(Date.now() / 1000) &lt;= lastInteraction + timeout) {
      throw new Error(errorConstants.TIMEOUT_NOT_REACHED)
    }

    try {
      return this.contractInstance.timeOutByBuyer(arbitrableTransactionId, {
        from: account,
        value: 0
      })
    } catch (err) {
      console.error(err)
      throw new Error(errorConstants.UNABLE_TO_CALL_TIMEOUT)
    }
  }

  /**
   * Call by seller if buyer is timeout.
   * @param {string} account - ETH address of user.
   * @param {number} arbitrableTransactionId - The index of the transaction.
   * @param {string} contractAddress - ETH address of contract.
   * @returns {object} The result transaction object.
   */
  callTimeOutSeller = async (
    account,
    arbitrableTransactionId
  ) =&gt; {
    await this.loadContract()

    const status = await this.contractInstance.status()
    const timeout = await this.contractInstance.timeout()
    const lastInteraction = await this.contractInstance.lastInteraction()

    if (status !== contractConstants.STATUS.WAITING_BUYER) {
      throw new Error(errorConstants.CONTRACT_IS_NOT_WAITING_ON_OTHER_PARTY)
    } else if (Date.now() &gt;= lastInteraction + timeout) {
      throw new Error(errorConstants.TIMEOUT_NOT_REACHED)
    }

    try {
      return this.contractInstance.timeOutBySeller(arbitrableTransactionId, {
        from: account,
        value: 0
      })
    } catch (err) {
      console.error(err)
      throw new Error(errorConstants.UNABLE_TO_CALL_TIMEOUT)
    }
  }

  /**
   * Appeal an appealable ruling.
   * @param {string} account Ethereum account.
   * @param {number} arbitrableTransactionId - The index of the transaction.
   * @param {bytes} extraData for the arbitrator appeal procedure.
   * @param {number} appealCost Amount to pay the arbitrator. (default 0.35 ether).
   * @returns {object} - The result transaction object.
   */
  appeal = async (
    account,
    arbitrableTransactionId,
    extraData = 0x0,
    appealCost = 0.3
  ) =&gt; {
    await this.loadContract()

    try {
      return this.contractInstance.appeal(arbitrableTransactionId, extraData, {
        from: account,
        value: appealCost
      })
    } catch (err) {
      console.error(err)
      throw new Error(errorConstants.UNABLE_TO_RAISE_AN_APPEAL)
    }
  }

  /**
   * Set the arbitrable transaction id
   * @param {number} arbitrableTransactionId - The index of the transaction.
   * @returns {object} Object Data of the contract.
   */
  setArbitrableTransactionId = arbitrableTransactionId =&gt;
    (this.arbitrableTransactionId = arbitrableTransactionId)

  /**
   * Data of the contract
   * @param {number} arbitrableTransactionId - The index of the transaction.
   * @returns {object} Object Data of the contract.
   */
  getData = async arbitrableTransactionId =&gt; {
    await this.loadContract()

    const arbitrableTransaction = await this.contractInstance.transactions(
      arbitrableTransactionId
    )

    return {
      seller: arbitrableTransaction[0],
      buyer: arbitrableTransaction[1],
      amount: arbitrableTransaction[2].toNumber(),
      timeout: arbitrableTransaction[3].toNumber(),
      disputeId: arbitrableTransaction[4].toNumber(),
      arbitrator: arbitrableTransaction[5],
      arbitratorExtraData: arbitrableTransaction[6],
      sellerFee: this._Web3Wrapper.fromWei(arbitrableTransaction[7], &apos;ether&apos;),
      buyerFee: this._Web3Wrapper.fromWei(arbitrableTransaction[8], &apos;ether&apos;),
      lastInteraction: arbitrableTransaction[9].toNumber(),
      status: arbitrableTransaction[10].toNumber(),
      metaEvidence: await this.getMetaEvidence(arbitrableTransactionId),
      evidence: await this.getEvidence(
        arbitrableTransaction[5],
        arbitrableTransaction[4].toNumber()
      )
    }
  }
}

export default MultipleArbitrableTransaction
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
